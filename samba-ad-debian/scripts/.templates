# This file is to be sourced from the setup script

NETLOGON="
[netlogon]
	path = /var/lib/samba/sysvol/$REALM/scripts
	read only = No
"

SMBCONF="
# Generated by entrypoint.sh. Add customizations under /etc/samba/conf.d.
#  DO NOT EDIT THIS FILE.
[global]
	netbios name = $NETBIOS_NAME
	realm = $REALM
	server role = active directory domain controller
	server services = s3fs, rpc, nbt, wrepl, ldap, cldap, kdc, drepl, winbindd, ntp_signd, kcc, dnsupdate
	server string = $SERVER_STRING
	workgroup = $WORKGROUP
	idmap_ldb:use rfc2307 = yes

	add machine script = /usr/sbin/adduser -D -H -G users -s /bin/false %u
	allow dns updates = $ALLOW_DNS_UPDATES
	domain logons = $DOMAIN_LOGONS
	domain master = $DOMAIN_MASTER
	log level = $LOG_LEVEL
	winbind refresh tickets = yes
	winbind use default domain = $WINBIND_USE_DEFAULT_DOMAIN
	${INTERFACES:+interfaces = $INTERFACES}
	${BIND_INTERFACES_ONLY:+bind interfaces only = $BIND_INTERFACES_ONLY}
	${DNS_FORWARDER:+dns forwarder = $DNS_FORWARDER}
	${LDAP_ALLOW_INSECURE:+ldap server require strong auth = no}

	tls enabled  = yes
	tls keyfile  = tls/server.key
	tls certfile = tls/server.crt
	tls cafile   = tls/ca.crt
"

SYSVOL="
[sysvol]
	path = /var/lib/samba/sysvol
	read only = No
"

KRB5CONF="
[libdefaults]
	default_realm = $REALM
	dns_lookup_realm = false
	dns_lookup_kdc = true

[realms]
	$REALM = {
		kdc = $NETBIOS_NAME.$REALM:88
		admin_server = $NETBIOS_NAME.$REALM:749
		kpasswd_server = $NETBIOS_NAME.$REALM
		default_domain = $REALM
	}

[domain_realm]
	.$REALM = $NETBIOS_NAME.$REALM
	$REALM = $NETBIOS_NAME.$REALM
	$WORKGROUP = $REALM
"